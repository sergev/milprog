#summary JTAG interface (Russian).

= Адаптер USB-JTAG =
[http://milprog.googlecode.com/svn/wiki/images/arm-usb-tiny.jpg]

Адаптер [http://www.olimex.com/dev/arm-usb-tiny.html Olimex ARM-USB-Tiny] построен на основе микросхемы FTDI FT2232D. Он позволяет через интерфейс USB производить обмен данными с портом JTAG. В качестве программного интерфейса используется библиотека
[http://www.libusb.org/ libusb-0.1]. Имеются версии linusb для Linux, Mac OS X и
[http://sourceforge.net/apps/trac/libusb-win32/wiki Windows].

= Блок отладки =
Микроконтроллеры Миландр 1986ВМ9x имеют ядро с архитектурой ARM Cortex-M3.
Порт JTAG оснащён блоком отладки, реализующим протокол
[http://infocenter.arm.com/help/topic/com.arm.doc.ihi0031a/index.html ARM Debug Interface v5].

Иллюстрации:
 * [figure_tap_ru   Схема состояний машины TAP]
 * [figure_dp_ru    Доступ к регистрам блока DP]
 * [figure_memap_ru Доступ к регистрам блока MEM-AP]

Регистр IR (instruction register) блока TAP имеет 4-битный размер и может принимать следующие значения:
 * ABORT (0x8) - останов транзакции, в нашем случае не используется.
 * DPACC (0xA) - доступ к регистрам уровня DP (debug port).
 * APACC (0xB) - доступ к регистрам уровня MEM-AP (memory access port).
 * IDCODE (0xE) - чтение идентификатора микросхемы.
 * BYPASS (0xF) - проброс данных с задержкой на 1 такт.

Регистр IDCODE:
|| *,,31--------------28,,* || *,,27--------------------------12,,* || *,,11-------------------------------0,,* ||
|| Version = 0x4 || Part number = 0xBA00 || Manufacturer ID = 0x477 ||

= Регистры DP (debug port) =
Обращение к регистрам блока DP производится посредством установки IR:=DPACC.
Транзакция имеет размер 35 бит:
 * Бит 0: тип обращения, 0-запись, 1-чтение.
 * Биты 1-2: старшие разряды адреса регистра DP.
 * Биты 3-34: данные.

Блок DP содержит четыре регистра:
 * ABORT (0x0)     - останов транзакции (только запись). В нашем случае не используется.
 * CTRL/STAT (0x4) - управление и статус (чтение и запись).
 * SELECT (0x8)    - адрес для выбора регистра блока MEM-AP (чтение и запись).
 * RDBUFF (0xC)    - буфер для чтения результата предыдущей транзакции (только чтение).

Регистр CTRL/STAT:

[http://milprog.googlecode.com/svn/wiki/images/dp-ctrl-stat.png]

 * Бит 31: CSYSPWRUPACK - подтверждение подачи питания системы (только чтение).
 * Бит 30: CSYSPWRUPREQ - запрос подачи питания системы (чтение и запись).
 * Бит 29: CDBGPWRUPACK - подтверждение подачи питания блока отладки (только чтение).
 * Бит 28: CDBGPWRUPREQ - запрос подачи питания блока отладки (чтение и запись).
 * Бит 27: CDBGRSTACK - подтверждение сброса блока отладки (только чтение).
 * Бит 26: CDBGRSTREQ - запрос сброса блока отладки (чтение и запись).
 * Биты 23-12: TRNCNT - счётчик транзакций (чтение и запись).
 * Биты 11-8: MASKLANE - маска байтов для транзакций 'pushed compare' и 'pushed verify' (чтение и запись).
 * Бит 5: STICKYERR - залипающая ошибка AP-транзакции (сброс записью единицы).
 * Бит 4: STICKYCMP - залипающий результат транзакций 'pushed compare' и 'pushed verify' (сброс записью единицы).
 * Биты 3-2: TRNMODE - режим AP-транзакций (чтение и запись).
 * Бит 1: STICKYORUN - залипающая ошибка переполнения (сброс записью единицы).
 * Бит 0: ORUNDETECT - разрешение обнаружения ошибок переполнения (чтение и запись).

Регистр SELECT:

[http://milprog.googlecode.com/svn/wiki/images/dp-select.png]

 * Биты 31-24: APSEL - выбор блока AP (чтение и запись). В нашем случае всегда 0.
 * Биты 7-4: APBANKSEL - старшие разряды адреса A[7:4] для обращения к регистрам MEM-AP (чтение и запись).

= Регистры MEM-AP (memory access port) =
(TODO)
