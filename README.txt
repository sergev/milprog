Утилита MILPROG предназначена для записи программного обеспечения
в Flash-память микроконтроллеров Миландр с архитектурой ARM
(1986ВМ91Т, 1986ВМ92УТ, 1986ВМ93У). В качестве программатора
используется адаптер Olimex ARM-USB-Tiny.


=== Вызов ===

При вызове без параметров утилита MILPROG определяет тип процессора
и flash-памяти, установленных на плате. Например:

    % milprog
    Programmer for Milandr ARM microcontrollers, Version 1.0
    Copyright (C) 2010 Serge Vakulenko.
    Processor: Milandr 1986BM91T (id 412FC230)
    Flash memory: 128 kbytes

Запись в flash-память:

    milprog [-v] file.srec
    milprog [-v] file.bin [address]

Запись в статическую память:

    milprog -w [-v] file.sreс
    milprog -w [-v] file.bin [address]

Чтение памяти в файл:

    milprog -r file.bin address length

Параметры:

    file.srec   - файл с прошивкой в формате SREC
    file.bin    - бинарный файл с прошивкой
    address     - адрес flash-памяти, по умолчанию 0x08000000
    -v          - без записи, только проверка памяти на совпадение
    -w          - запись в статическую память
    -r          - режим чтения

При завершении работы утилита производит аппаратный сброс процессора
(сигнал /SYSRST).

Входной файл должен иметь простой бинарный формат, или SREC. Формат SREC
предпочтительнее, так как в нём имеется информация об адресах программы.
Преобразовать формат ELF или COFF или A.OUT в SREC можно командой objcopy,
например:

    objcopy -O srec firmware.elf firmware.srec


=== Исходные тексты ===

Исходные тексты распространяются на условиях лицензии GPL. Их можно
скачать через Git командой:

    git clone https://github.com/sergev/milprog.git

___
С уважением,
Сергей Вакуленко



Процесс установки milprog в Ubuntu (11.04)
------------------------------------------
1) Установить версию libusb для разработчика:
	sudo apt-get install libusb-dev
2) Скомпилировать milprog командой make
3) (Опционально) Установить milprog в /usr/local/bin:
	sudo make install
	
Процесс установки milprog в Windows XP
--------------------------------------
1) При подключении JTAG-адаптера ОС спросит, какие драйвера устанавливать.
Необходимо выбрать пункт "Из указанного места" и далее указать путь
к папке libusb-win32-bin-1.2.4.0. Затем ОС задаст тот же вопрос для второго
интерфейса адаптера - в точности повторить процедуру.
2) Если в ОС уже установлены какие-либо драйвера для ARM-USB-TINY, то milprog
может не работать. В этом случае необходимо выполнить очистку системы от драйверов
FTDI. Необходимые утилиты и инструкция, как это делать (на английском языке), 
лежит в папке FTClean. Обратите внимание, что при очистке драйверов для
ARM-USB-TINY в поле PID необходимо ввести "0004" вместо "002a".
3) Папка libusb-win32-bin-1.2.4.0 содержит установочные файлы драйверов
только для 32-битной версии Windows XP. Для других версий Windows необходимо утилитой
libusb-win32-bin-1.2.4.0\bin\inf-wizard.exe создать самостоятельно нужные
файлы (процесс создания интуитивно понятен).
4) Исполняемый файл milprog.exe готов к применению. При желании его можно
пересобрать из исходников с помощью командного файла compile.bat

Примечание. Работа программы проверялась только в ОС Ubuntu и 32-разрядной WinXP.

С уважением,
   Дмитрий Подхватилин
